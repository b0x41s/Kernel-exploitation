#include <unistd.h>
#include <string.h>
#include <stropts.h>
#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <sys/stat.h>
#include <sys/shm.h>

// / # cat /proc/kallsyms | grep krock
// ffffffffc0000000 t krock_open [krock_two]
// ffffffffc0000010 t krock_ioctl  [krock_two]
// ffffffffc00000b9 t krock_ioctl.cold.1 [krock_two]
// ffffffffc0000060 t krock_release  [krock_two]
// ffffffffc00000db t init_module.cold.2 [krock_two]
// ffffffffc00000a0 t cleanup_module [krock_two]
// ffffffffc0000070 t init_module  [krock_two]


// eerst 4919 dan 4918 (twee keer)
// tweede ronde 4919 en 1094795585 = 0x41414141
// raidforums writeups verkopen

/* file descriptor to the opened device (global variable for convenience) */
int fd = -1;


void open_hfs() {
  fd = open("/dev/krock_two", O_RDWR);
  if (fd < 0) {
    perror("[-] open hfs failed");
    exit(1);
  }
  printf("[+] open fd: %x\n", fd);
}

void main() {
  int value, value2, returned, secondvalue;

  open_hfs(); 
	//printf("Sending...");
  // deze eerste klopt
  //ioctl(fd, 0x1336, 0x1337, 0x41414141, (int32_t*) &number);
  printf("Enter the first Value to send\n");
  scanf("%d",&value);
  printf("Enter the second Value to send\n");
  scanf("%d",&value2);

  int i;

  for (i = 1; i < 12; ++i)
  {
  printf("Writing Value to Driver\n");
  printf("%d\n",i);
  ioctl(fd, value, value2, (int*) &returned);
  // 
  }
  ioctl(fd, 4918, 0x353738443); 
  //printf("Writing Value to Driver\n");
  //ioctl(fd, value, value2, (int*) &returned); 

  //ioctl(fd, 0x1336, 0x1337);  
}